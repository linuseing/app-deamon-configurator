import{g as U,r as o,j as e}from"./chunk-JZWAC4HX-bs4pZpVQ.js";import{a as z}from"./index-DGVGBDgr.js";function P(t){if(t)return Object.keys(t)[0]}function G(t){return"entity"in t}function J(t){return"number"in t}function Q(t){return"text"in t}function X(t){return"boolean"in t}function Y(t){return"select"in t}function Z(t){return"notify"in t}function K(t){return"input"in t}function _(t){let m={};if(!t)return m;for(const[c,r]of Object.entries(t))K(r)?m={...m,..._(r.input)}:m[c]=r;return m}function q({name:t,label:m,description:c,domain:r,required:p,register:N,errors:d}){const b=Array.isArray(r)?r.join(", "):r,h=d?.[t],u=U("root"),C=u?.basename==="/"?"":u?.basename||"",E=C||(typeof window<"u"?window.BASENAME:"")||"";o.useEffect(()=>{console.log("[EntityInput] Mounted",{name:t,basename:C,effectiveBasename:E,rootData:u})},[t,C,E,u]);const[x,k]=o.useState([]),[g,v]=o.useState(!1),[I,D]=o.useState([]),[w,i]=o.useState(!1),[f,y]=o.useState(""),[j,F]=o.useState(-1),[B,V]=o.useState(!1),$=o.useRef(null),T=o.useRef([]),{ref:H,...A}=N(t,{required:p}),L=()=>{const s=new URLSearchParams;if(r){const S=Array.isArray(r)?r:[r];s.append("domain",S.join(","))}const l=`${E}/api/entities?${s.toString()}`;return console.log("[EntityInput] Built URL:",l),l},M=async()=>{if(console.log("[EntityInput] fetchEntities called",{isLoading:g,hasFetched:B}),!g){v(!0);try{const s=L();console.log("[EntityInput] Fetching:",s);const l=await fetch(s);if(console.log("[EntityInput] Response status:",l.status),l.ok){const S=await l.json();console.log("[EntityInput] Data received:",S),S.entities&&(k(S.entities),D(S.entities),B||i(!0))}else console.error("Failed to fetch entities:",l.status)}catch(s){console.error("Error fetching entities:",s)}finally{v(!1),V(!0)}}};o.useEffect(()=>{if(x.length>0){const s=x.filter(l=>l.value.toLowerCase().includes(f.toLowerCase())||l.label.toLowerCase().includes(f.toLowerCase()));D(s)}},[f,x]);const R=I;o.useEffect(()=>{F(-1)},[R.length]),o.useEffect(()=>{j>=0&&T.current[j]&&T.current[j]?.scrollIntoView({block:"nearest",behavior:"smooth"})},[j]);const n=s=>{const l=document.getElementById(t);if(l){l.value=s.value;const S=new Event("input",{bubbles:!0});l.dispatchEvent(S),y(s.value)}i(!1),F(-1)},a=s=>{if(!w||R.length===0){(s.key==="ArrowDown"||s.key==="ArrowUp")&&i(!0);return}s.key==="ArrowDown"?(s.preventDefault(),F(l=>l<R.length-1?l+1:l)):s.key==="ArrowUp"?(s.preventDefault(),F(l=>l>0?l-1:-1)):s.key==="Enter"&&j>=0?(s.preventDefault(),n(R[j])):s.key==="Escape"&&(i(!1),F(-1))};return e.jsxs("div",{className:"space-y-1.5 relative",children:[e.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-base-content",children:[m,p&&e.jsx("span",{className:"text-error ml-1",children:"*"})]}),e.jsxs("div",{className:"flex relative",children:[e.jsx("input",{type:"text",id:t,autoComplete:"off",placeholder:b?`${b}.entity_id`:"entity_id",className:`input input-bordered input-sm flex-1 font-mono text-sm bg-base-200 border-base-300 focus:border-primary ${h?"input-error":""}`,...A,ref:s=>{H(s)},onChange:s=>{A.onChange(s),y(s.target.value),i(!0)},onKeyDown:a,onFocus:()=>{B||M(),I.length>0&&i(!0)},onBlur:s=>{A.onBlur(s),setTimeout(()=>i(!1),200)}}),e.jsx("button",{type:"button",tabIndex:-1,onClick:()=>{M(),I.length>0&&i(!0)},className:`btn btn-sm btn-ghost ml-1 ${g?"loading":""}`,title:"Refresh entities from Home Assistant",children:g?null:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),w&&R.length>0&&e.jsx("ul",{ref:$,className:"absolute z-50 top-full left-0 right-12 mt-1 max-h-60 overflow-y-auto bg-base-100 border border-base-300 rounded-lg shadow-lg",children:R.map((s,l)=>e.jsxs("li",{ref:S=>{T.current[l]=S},className:`px-3 py-2 text-sm cursor-pointer flex flex-col ${l===j?"bg-primary text-primary-content":"hover:bg-base-200"}`,onMouseDown:S=>{S.preventDefault(),n(s)},onMouseEnter:()=>F(l),children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:`text-xs font-mono ${l===j?"text-primary-content/70":"text-base-content/50"}`,children:s.value})]},s.value))})]}),h&&e.jsx("p",{className:"text-xs text-error",children:h.message||"This field is required"}),c&&!h&&e.jsx("p",{className:"text-xs text-base-content/50",children:c})]})}function ee({name:t,label:m,description:c,min:r,max:p,step:N=1,unit:d,mode:b="box",required:h,control:u,errors:C,defaultValue:E}){const{field:x}=z({name:t,control:u,defaultValue:E??r??0}),[k,g]=o.useState(x.value?.toString()??(r??0).toString());o.useEffect(()=>{x.value!==void 0&&x.value!==null&&Number(k)!==x.value&&g(x.value.toString())},[x.value]);const v=C?.[t],I=i=>{const f=Number(i.target.value);g(f.toString()),x.onChange(f)},D=i=>{const f=i.target.value;if(g(f),f===""||f==="-")return;const y=parseFloat(f);isNaN(y)||x.onChange(y)},w=()=>{if(k===""||k==="-"){const i=r??0;g(i.toString()),x.onChange(i)}else{const i=parseFloat(k);if(!isNaN(i)){let f=i;r!==void 0&&f<r&&(f=r),p!==void 0&&f>p&&(f=p),g(f.toString()),x.onChange(f)}}x.onBlur()};return b==="slider"?e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-base-content",children:[m,h&&e.jsx("span",{className:"text-error ml-1",children:"*"})]}),e.jsxs("span",{className:"text-sm font-mono text-base-content/70",children:[x.value,d&&e.jsx("span",{className:"text-base-content/50 ml-0.5",children:d})]})]}),e.jsx("input",{type:"range",id:t,min:r,max:p,step:N,value:x.value??r??0,onChange:I,className:"range range-sm range-primary"}),v&&e.jsx("p",{className:"text-xs text-error",children:v.message}),c&&!v&&e.jsx("p",{className:"text-xs text-base-content/50",children:c})]}):e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-base-content",children:[m,h&&e.jsx("span",{className:"text-error ml-1",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",inputMode:"decimal",id:t,value:k,onChange:D,onBlur:w,className:`input input-bordered input-sm w-32 font-mono bg-base-200 border-base-300 focus:border-primary ${v?"input-error":""}`}),d&&e.jsx("span",{className:"text-sm text-base-content/50",children:d})]}),v&&e.jsx("p",{className:"text-xs text-error",children:v.message}),c&&!v&&e.jsx("p",{className:"text-xs text-base-content/50",children:c})]})}function te({name:t,label:m,description:c,multiline:r=!1,type:p="text",placeholder:N,required:d,register:b,errors:h}){const u=h?.[t];return r?e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-base-content",children:[m,d&&e.jsx("span",{className:"text-error ml-1",children:"*"})]}),e.jsx("textarea",{id:t,placeholder:N,rows:4,className:`textarea textarea-bordered textarea-sm w-full font-mono text-sm bg-base-200 border-base-300 focus:border-primary resize-y ${u?"textarea-error":""}`,...b(t,{required:d})}),u&&e.jsx("p",{className:"text-xs text-error",children:u.message||"This field is required"}),c&&!u&&e.jsx("p",{className:"text-xs text-base-content/50",children:c})]}):e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-base-content",children:[m,d&&e.jsx("span",{className:"text-error ml-1",children:"*"})]}),e.jsx("input",{type:p,id:t,placeholder:N,className:`input input-bordered input-sm w-full bg-base-200 border-base-300 focus:border-primary ${u?"input-error":""}`,...b(t,{required:d})}),u&&e.jsx("p",{className:"text-xs text-error",children:u.message||"This field is required"}),c&&!u&&e.jsx("p",{className:"text-xs text-base-content/50",children:c})]})}function se({name:t,label:m,description:c,control:r,defaultValue:p=!1}){const{field:N}=z({name:t,control:r,defaultValue:p});return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",id:t,checked:N.value??!1,onChange:d=>N.onChange(d.target.checked),className:"checkbox checkbox-sm checkbox-primary"}),e.jsx("span",{className:"text-sm font-medium text-base-content",children:m})]}),c&&e.jsx("p",{className:"text-xs text-base-content/50 ml-7",children:c})]})}function ne({name:t,label:m,description:c,options:r,required:p,register:N,errors:d}){const b=d?.[t];return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-base-content",children:[m,p&&e.jsx("span",{className:"text-error ml-1",children:"*"})]}),e.jsxs("select",{id:t,className:`select select-bordered select-sm w-full bg-base-200 border-base-300 focus:border-primary ${b?"select-error":""}`,...N(t,{required:p}),children:[e.jsx("option",{value:"",children:"Select..."}),r.map(h=>{const u=typeof h=="string"?h:h.value,C=typeof h=="string"?h:h.label;return e.jsx("option",{value:u,children:C},u)})]}),b&&e.jsx("p",{className:"text-xs text-error",children:b.message||"This field is required"}),c&&!b&&e.jsx("p",{className:"text-xs text-base-content/50",children:c})]})}function re({name:t,label:m,description:c,required:r,register:p,errors:N}){const d=N?.[t],b=U("root"),h=b?.basename==="/"?"":b?.basename||"",[u,C]=o.useState([]),[E,x]=o.useState(!1),[k,g]=o.useState(null),[v,I]=o.useState([]),[D,w]=o.useState(!1),[i,f]=o.useState(""),[y,j]=o.useState(-1),[F,B]=o.useState(!1),V=o.useRef(null),$=o.useRef([]),{ref:T,...H}=p(t,{required:r}),A=async()=>{if(!E){x(!0),g(null);try{const n=await fetch(`${h}/api/notify-services`);if(n.ok){const a=await n.json();a.services?(C(a.services),I(a.services),F||w(!0)):a.error&&(console.error("Error fetching notification services:",a.error),g(a.error),I([]))}else console.error("Failed to fetch notification services:",n.status),g(`Failed to fetch: ${n.status}`)}catch(n){console.error("Error fetching notification services:",n),g("Network error")}finally{x(!1),B(!0)}}};o.useEffect(()=>{const n=u.filter(a=>a.value.toLowerCase().includes(i.toLowerCase())||a.label.toLowerCase().includes(i.toLowerCase()));I(n)},[i,u]);const L=v;o.useEffect(()=>{j(-1)},[L.length]),o.useEffect(()=>{y>=0&&$.current[y]&&$.current[y]?.scrollIntoView({block:"nearest",behavior:"smooth"})},[y]);const M=n=>{const a=document.getElementById(t);if(a){a.value=n.value;const s=new Event("input",{bubbles:!0});a.dispatchEvent(s),f(n.value)}w(!1),j(-1)},R=n=>{if(!D||L.length===0){(n.key==="ArrowDown"||n.key==="ArrowUp")&&w(!0);return}n.key==="ArrowDown"?(n.preventDefault(),j(a=>a<L.length-1?a+1:a)):n.key==="ArrowUp"?(n.preventDefault(),j(a=>a>0?a-1:-1)):n.key==="Enter"&&y>=0?(n.preventDefault(),M(L[y])):n.key==="Escape"&&(w(!1),j(-1))};return e.jsxs("div",{className:"space-y-1.5 relative",children:[e.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-base-content",children:[m,r&&e.jsx("span",{className:"text-error ml-1",children:"*"})]}),e.jsxs("div",{className:"flex relative",children:[e.jsx("input",{type:"text",id:t,autoComplete:"off",placeholder:"notify.mobile_app_phone",className:`input input-bordered input-sm flex-1 font-mono text-sm bg-base-200 border-base-300 focus:border-primary ${d?"input-error":""}`,...H,ref:n=>{T(n)},onChange:n=>{H.onChange(n),f(n.target.value),w(!0)},onKeyDown:R,onFocus:()=>{F||A(),v.length>0&&w(!0)},onBlur:n=>{H.onBlur(n),setTimeout(()=>w(!1),200)}}),e.jsx("button",{type:"button",tabIndex:-1,onClick:()=>{A(),v.length>0&&w(!0)},className:`btn btn-sm btn-ghost ml-1 ${E?"loading":""}`,title:"Refresh notification services from Home Assistant",children:E?null:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),D&&L.length>0&&e.jsx("ul",{ref:V,className:"absolute z-50 top-full left-0 right-12 mt-1 max-h-60 overflow-y-auto bg-base-100 border border-base-300 rounded-lg shadow-lg",children:L.map((n,a)=>e.jsxs("li",{ref:s=>{$.current[a]=s},className:`px-3 py-2 text-sm cursor-pointer flex flex-col ${a===y?"bg-primary text-primary-content":"hover:bg-base-200"}`,onMouseDown:s=>{s.preventDefault(),M(n)},onMouseEnter:()=>j(a),children:[e.jsx("span",{className:"font-medium",children:n.label}),e.jsx("span",{className:`text-xs font-mono ${a===y?"text-primary-content/70":"text-base-content/50"}`,children:n.value})]},n.value))}),D&&!E&&!k&&v.length===0&&e.jsx("div",{className:"absolute z-50 top-full left-0 right-12 mt-1 p-3 bg-base-100 border border-base-300 rounded-lg shadow-lg text-sm text-base-content/60",children:"No notification services found"}),k&&e.jsx("div",{className:"absolute z-50 top-full left-0 right-12 mt-1 p-3 bg-error/10 border border-error rounded-lg shadow-lg text-sm text-error",children:k})]}),d&&e.jsx("p",{className:"text-xs text-error",children:d.message||"This field is required"}),c&&!d&&e.jsx("p",{className:"text-xs text-base-content/50",children:c})]})}export{se as B,q as E,ee as N,ne as S,te as T,G as a,J as b,Q as c,X as d,Y as e,_ as f,Z as g,re as h,K as i,P as j};
