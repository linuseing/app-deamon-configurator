import{w as I,j as e,L as b,r as j,F as k}from"./chunk-JZWAC4HX-bs4pZpVQ.js";import{f as C,i as E,T as v,a as L,E as F,b as T,N as B,c as O,d as $,B as z,e as M,S as V,g as W,h as q,j as A}from"./NotificationInput-BS9H4_Gc.js";import{u as D}from"./index-DGVGBDgr.js";function H({data:i}){const s=i?.instance?.id??"Edit Instance";return[{title:`Edit ${s} | AppDaemon Configurator`},{name:"description",content:`Edit app instance ${s}`}]}const Q=I(function({loaderData:s}){const{instance:n,blueprint:l,categories:r}=s;return l?e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-base-content/50 mb-2",children:[e.jsx(b,{to:"/instances",className:"hover:text-base-content",children:"Instances"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-base-content font-mono",children:n.id})]}),e.jsxs("h1",{className:"text-xl font-semibold",children:["Edit ",n.id]}),e.jsx("p",{className:"text-sm text-base-content/50 mt-1",children:l.blueprint.description})]}),e.jsx("div",{className:"rounded-lg border border-base-300 bg-base-100 p-4",children:e.jsx(J,{blueprint:l,blueprintId:n._blueprint,instanceId:n.id,existingValues:n.config,availableCategories:r,currentCategory:n._category,currentTags:n._tags})})]}):e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-base-content/50 mb-2",children:[e.jsx(b,{to:"/instances",className:"hover:text-base-content",children:"Instances"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-base-content font-mono",children:n.id})]}),e.jsx("h1",{className:"text-xl font-semibold",children:"Edit Instance"})]}),e.jsxs("div",{className:"rounded-lg border border-warning/30 bg-warning/5 p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-lg bg-warning/10 mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-warning",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-base font-medium mb-2",children:"No Blueprint Found"}),e.jsxs("p",{className:"text-sm text-base-content/60 mb-4",children:["This instance was not created with a blueprint (no ",e.jsx("code",{className:"text-xs bg-base-200 px-1 py-0.5 rounded",children:"_blueprint"})," field). Edit the ",e.jsx("code",{className:"text-xs bg-base-200 px-1 py-0.5 rounded",children:"apps.yaml"})," file directly to modify this instance."]}),e.jsx(b,{to:"/instances",className:"btn btn-ghost btn-sm",children:"Back to Instances"})]}),e.jsxs("div",{className:"mt-6 p-4 rounded-lg border border-base-300 bg-base-100",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Current Configuration"}),e.jsx("pre",{className:"text-xs font-mono bg-base-200 p-3 rounded overflow-x-auto",children:JSON.stringify(n.config,null,2)})]})]})});function J({blueprint:i,blueprintId:s,instanceId:n,existingValues:l,availableCategories:r,currentCategory:t,currentTags:p}){const[c,u]=j.useState(p??[]),[o,h]=j.useState(""),m={_instanceName:n},w=C(i.input);for(const[a,d]of Object.entries(w))l[a]!==void 0?m[a]=l[a]:d.default!==void 0&&(m[a]=d.default);const{register:f,control:S,handleSubmit:_,formState:{errors:x,isSubmitting:g},reset:N}=D({defaultValues:m,submitConfig:{method:"POST"}});return j.useEffect(()=>{N(m)},[s,N]),e.jsxs(k,{method:"post",onSubmit:_,children:[e.jsx("input",{type:"hidden",name:"blueprintId",value:s}),e.jsx("div",{className:"pb-4 mb-4 border-b border-base-300",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{htmlFor:"_instanceName",className:"block text-sm font-medium text-base-content",children:["Instance Name",e.jsx("span",{className:"text-error ml-1",children:"*"})]}),e.jsx("input",{type:"text",id:"_instanceName",placeholder:s.replace(/-/g,"_"),className:`input input-bordered input-sm w-full font-mono text-sm bg-base-200 border-base-300 focus:border-primary ${x._instanceName?"input-error":""}`,...f("_instanceName",{required:"Instance name is required",pattern:{value:/^[a-z][a-z0-9_]*$/,message:"Must start with letter, use only lowercase letters, numbers, and underscores"}})}),x._instanceName?e.jsx("p",{className:"text-xs text-error",children:x._instanceName.message}):e.jsx("p",{className:"text-xs text-base-content/50",children:"Unique identifier for this app instance in apps.yaml"})]})}),e.jsxs("div",{className:"pb-4 mb-4 border-b border-base-300 space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{htmlFor:"_category",className:"block text-sm font-medium text-base-content",children:"Category"}),e.jsxs("select",{id:"_category",className:"select select-bordered select-sm w-full bg-base-200 border-base-300 focus:border-primary",defaultValue:t??"",...f("_category"),children:[e.jsx("option",{value:"",children:"No category"}),r.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("p",{className:"text-xs text-base-content/50",children:"Organize instances by category (configure in Settings)"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-base-content",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:a=>h(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),o.trim()&&!c.includes(o.trim())&&(u([...c,o.trim()]),h("")))},placeholder:"Add tag...",className:"input input-bordered input-sm flex-1 bg-base-200 border-base-300 focus:border-primary"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-ghost",onClick:()=>{o.trim()&&!c.includes(o.trim())&&(u([...c,o.trim()]),h(""))},children:"Add"})]}),c.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:c.map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-base-200 text-base-content/70 text-xs",children:[a,e.jsx("button",{type:"button",onClick:()=>u(c.filter(d=>d!==a)),className:"hover:bg-base-300 rounded-full p-0.5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},a))}),e.jsx("input",{type:"hidden",name:"_tags",value:JSON.stringify(c)}),e.jsx("p",{className:"text-xs text-base-content/50",children:"Free-form tags for filtering and organization"})]})]}),e.jsx("div",{className:"divide-y divide-base-300",children:i.input&&Object.entries(i.input).map(([a,d])=>e.jsx(y,{itemKey:a,item:d,register:f,control:S,errors:x},a))}),!i.input&&e.jsx("div",{className:"py-8 text-center text-base-content/50",children:"No configuration options available for this blueprint."}),e.jsxs("div",{className:"pt-4 border-t border-base-300 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-xs"}),"Saving..."]}):e.jsxs(e.Fragment,{children:["Save Changes",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]})}),e.jsx(b,{to:"/instances",className:"btn btn-ghost btn-sm",children:"Cancel"})]})]})}function y({itemKey:i,item:s,register:n,control:l,errors:r}){return E(s)?e.jsx("div",{className:"py-4 first:pt-0 last:pb-0",children:e.jsxs("details",{className:"group collapse collapse-arrow bg-base-100 border border-base-300 rounded-lg",children:[e.jsxs("summary",{className:"collapse-title text-base font-medium",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon&&e.jsx("span",{className:`mdi ${s.icon}`}),s.name]}),s.description&&e.jsx("div",{className:"text-xs font-normal text-base-content/60 mt-0.5",children:s.description})]}),e.jsx("div",{className:"collapse-content",children:e.jsx("div",{className:"divide-y divide-base-300",children:Object.entries(s.input).map(([t,p])=>e.jsx(y,{itemKey:t,item:p,register:n,control:l,errors:r},t))})})]})}):e.jsx("div",{className:"py-4 first:pt-0 last:pb-0",children:e.jsx(P,{inputKey:i,input:s,register:n,control:l,errors:r})})}function P({inputKey:i,input:s,register:n,control:l,errors:r}){const t=s.selector;return t?L(t)?e.jsx(F,{name:i,label:s.name,description:s.description,register:n,errors:r,domain:t.entity.domain,deviceClass:t.entity.device_class,multiple:t.entity.multiple}):T(t)?e.jsx(B,{name:i,label:s.name,description:s.description,control:l,errors:r,min:t.number.min,max:t.number.max,step:t.number.step,unit:t.number.unit_of_measurement,mode:t.number.mode,defaultValue:s.default}):O(t)?e.jsx(v,{name:i,label:s.name,description:s.description,register:n,errors:r,multiline:t.text.multiline,type:t.text.type}):$(t)?e.jsx(z,{name:i,label:s.name,description:s.description,control:l,defaultValue:s.default}):M(t)?e.jsx(V,{name:i,label:s.name,description:s.description,register:n,errors:r,options:t.select.options,multiple:t.select.multiple}):W(t)?e.jsx(q,{name:i,label:s.name,description:s.description,register:n,errors:r}):e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"block text-sm font-medium text-base-content",children:[s.name,e.jsxs("span",{className:"text-xs text-warning ml-2",children:["(unsupported: ",A(t),")"]})]}),e.jsx("input",{type:"text",className:"input input-bordered input-sm w-full bg-base-200 border-base-300",...n(i)}),s.description&&e.jsx("p",{className:"text-xs text-base-content/50",children:s.description})]}):e.jsx(v,{name:i,label:s.name,description:s.description,register:n,errors:r})}export{Q as default,H as meta};
